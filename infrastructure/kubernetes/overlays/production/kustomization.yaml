apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: checkin-app-production

# Base resources
resources:
  - ../base

# Production-specific patches
patches:
  # Increase backend replicas in production
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: 2
    target:
      kind: Deployment
      name: backend
  
  # Adjust HPA for production
  - patch: |-
      - op: replace
        path: /spec/minReplicas
        value: 2
      - op: replace
        path: /spec/maxReplicas
        value: 3
    target:
      kind: HorizontalPodAutoscaler
      name: backend-hpa

# Image configuration - update with your registry
images:
  - name: ghcr.io/mehdi-lakhzouri/checkin-backend
    newTag: latest
  - name: ghcr.io/mehdi-lakhzouri/checkin-frontend
    newTag: latest

# ConfigMap generator for production-specific config
configMapGenerator:
  - name: checkin-config-prod
    behavior: merge
    literals:
      - NODE_ENV=production
      - LOG_LEVEL=warn

# Production labels
commonLabels:
  environment: production
